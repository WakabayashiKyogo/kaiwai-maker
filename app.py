import os
from flask import Flask, request, render_template
import hashlib

app = Flask(__name__, static_folder='static', static_url_path='/static')

# すべての界隈（resultsに含まれる100項目）に対して、相性データを定義
# ※ good / bad はランダムに割り当てています。必要に応じて変更してください！
compatibility = {
    "風呂キャンセル界隈": {
        "good": "寝落ち界隈", 
        "bad": "シャワーだけで生きる界隈"
    },
    "だだ滑り界隈": {
        "good": "深夜テンションでポエム界隈", 
        "bad": "身内ノリ世界遺産界隈"
    },
    "屁こき界隈": {
        "good": "ギリギリ遅刻界隈", 
        "bad": "爆モテ界隈"
    },
    "爆モテ界隈": {
        "good": "カップル爆発しろ界隈", 
        "bad": "既読スルーされた側界隈"
    },
    "寝坊界隈": {
        "good": "昼夜逆転界隈", 
        "bad": "とりあえず朝活界隈"
    },
    "ギリギリ遅刻界隈": {
        "good": "バイト掛け持ち界隈", 
        "bad": "課題ギリ提出界隈"
    },
    "課題ギリ提出界隈": {
        "good": "テスト前日爆死界隈", 
        "bad": "明日から本気出す界隈"
    },
    "貯金ゼロ界隈": {
        "good": "ATM駆け込み界隈", 
        "bad": "クーポン使いこなす界隈"
    },
    "シンプルに金欠界隈": {
        "good": "100均で爆買い界隈", 
        "bad": "ポイ活ガチ勢界隈"
    },
    "ATMと会話界隈": {
        "good": "貯金ゼロ界隈", 
        "bad": "財布の中小銭しかない界隈"
    },
    "飯テロ界隈": {
        "good": "深夜ラーメン即決界隈", 
        "bad": "ダイエット開始5分で終了界隈"
    },
    "二次元オタク界隈": {
        "good": "アニメ考察ガチ勢界隈", 
        "bad": "FPSガチ勢界隈"
    },
    "アニメ考察ガチ勢界隈": {
        "good": "二次元オタク界隈", 
        "bad": "リアル恋愛重視界隈"  # ← 今回は仮に "爆モテ界隈" などにしてもOK
    },
    "FPSガチ勢界隈": {
        "good": "音ゲー指バキバキ界隈", 
        "bad": "カラオケ熱唱界隈"
    },
    "カップル爆発しろ界隈": {
        "good": "爆モテ界隈", 
        "bad": "彼女いない歴＝年齢界隈"
    },
    "彼女いない歴＝年齢界隈": {
        "good": "マッチングアプリ沼界隈", 
        "bad": "カップル爆発しろ界隈"
    },
    "一生片想い界隈": {
        "good": "推し尊すぎ界隈", 
        "bad": "爆モテ界隈"
    },
    "キスシーンで窒息界隈": {
        "good": "恋愛シミュレーションで学ぶ界隈", 
        "bad": "冷静ツッコミ界隈"  # ← 未使用キーがあれば適宜修正
    },
    "推し尊すぎ界隈": {
        "good": "一生片想い界隈", 
        "bad": "マッチングアプリ沼界隈"
    },
    "恋愛シミュレーションで学ぶ界隈": {
        "good": "キスシーンで窒息界隈", 
        "bad": "彼女いない歴＝年齢界隈"
    },
    "カラオケ熱唱界隈": {
        "good": "音ゲー指バキバキ界隈", 
        "bad": "スマホ落として顔面強打界隈"
    },
    "音ゲー指バキバキ界隈": {
        "good": "カラオケ熱唱界隈", 
        "bad": "イヤホン無限に絡まる界隈"
    },
    "スマホ落として顔面強打界隈": {
        "good": "スマホの画面バキバキ界隈", 
        "bad": "慎重派界隈"  # ← 慎重派界隈なし→ 例: "深夜テンションでポエム界隈"
    },
    "イヤホンの片方行方不明界隈": {
        "good": "スマホ落として顔面強打界隈", 
        "bad": "イヤホン無限に絡まる界隈"
    },
    "財布の中小銭しかない界隈": {
        "good": "ATMと会話界隈", 
        "bad": "旅行先で財布なくす界隈"
    },
    "バイト掛け持ち界隈": {
        "good": "ギリギリ遅刻界隈", 
        "bad": "シンプルに金欠界隈"
    },
    "深夜ラーメン即決界隈": {
        "good": "飯テロ界隈", 
        "bad": "スタバ新作全制覇界隈"
    },
    "ダイエット開始5分で終了界隈": {
        "good": "飯テロ界隈", 
        "bad": "映えスイーツ即撮影界隈"
    },
    "スタバ新作全制覇界隈": {
        "good": "映えスイーツ即撮影界隈", 
        "bad": "ダイエット開始5分で終了界隈"
    },
    "カフェ巡り界隈": {
        "good": "映えスイーツ即撮影界隈", 
        "bad": "タピオカ復活待望界隈"  # 適当に設定
    },
    "映えスイーツ即撮影界隈": {
        "good": "スタバ新作全制覇界隈", 
        "bad": "カフェ巡り界隈"
    },
    "タピオカ復活待望界隈": {
        "good": "カフェ巡り界隈", 
        "bad": "エナドリ依存界隈"
    },
    "エナドリ依存界隈": {
        "good": "徹夜作業界隈", 
        "bad": "タピオカ復活待望界隈"
    },
    "寝落ち界隈": {
        "good": "風呂キャンセル界隈", 
        "bad": "とりあえず朝活界隈"
    },
    "昼夜逆転界隈": {
        "good": "寝坊界隈", 
        "bad": "明日から本気出す界隈"
    },
    "明日から本気出す界隈": {
        "good": "謎のモチベ爆発界隈", 
        "bad": "課題ギリ提出界隈"
    },
    "徹夜作業界隈": {
        "good": "エナドリ依存界隈", 
        "bad": "昼夜逆転界隈"
    },
    "テスト前日爆死界隈": {
        "good": "課題ギリ提出界隈", 
        "bad": "自己啓発本読みまくる界隈"
    },
    "授業中夢の世界界隈": {
        "good": "黒歴史ノート発掘界隈", 
        "bad": "最初のページだけ綺麗界隈"
    },
    "黒歴史ノート発掘界隈": {
        "good": "授業中に落書き界隈", 
        "bad": "0から始めるノート術界隈"
    },
    "恋愛映画で号泣界隈": {
        "good": "感情移入しすぎ界隈", 
        "bad": "キスシーンで窒息界隈"
    },
    "感情移入しすぎ界隈": {
        "good": "恋愛映画で号泣界隈", 
        "bad": "一生片想い界隈"
    },
    "インスタ映え重視界隈": {
        "good": "映えスイーツ即撮影界隈", 
        "bad": "ストーリー秒で飛ばす界隈"
    },
    "ストーリー秒で飛ばす界隈": {
        "good": "通知OFF界隈", 
        "bad": "インスタ映え重視界隈"
    },
    "通知OFF界隈": {
        "good": "LINE未読100件界隈", 
        "bad": "鬼返信界隈"
    },
    "LINE未読100件界隈": {
        "good": "通知OFF界隈", 
        "bad": "既読スルーされた側界隈"
    },
    "オール明けゾンビ界隈": {
        "good": "寝落ち界隈", 
        "bad": "ギリギリ遅刻界隈"
    },
    "終電逃し界隈": {
        "good": "謎の自信で旅立つ界隈", 
        "bad": "オール明けゾンビ界隈"
    },
    "謎の自信で旅立つ界隈": {
        "good": "終電逃し界隈", 
        "bad": "寝坊界隈"
    },
    "旅行先で財布なくす界隈": {
        "good": "財布の中小銭しかない界隈", 
        "bad": "貯金ゼロ界隈"
    },
    "スマホの画面バキバキ界隈": {
        "good": "スマホ落として顔面強打界隈", 
        "bad": "スクショフォルダ地獄界隈"
    },
    "SNSのアイコンずっと同じ界隈": {
        "good": "プロフィール写真詐欺界隈", 
        "bad": "マッチングアプリ沼界隈"
    },
    "プロフィール写真詐欺界隈": {
        "good": "SNSのアイコンずっと同じ界隈", 
        "bad": "リアル世界重視界隈"  # 仮
    },
    "マッチングアプリ沼界隈": {
        "good": "爆モテ界隈", 
        "bad": "SNSのアイコンずっと同じ界隈"
    },
    "既読スルーされた側界隈": {
        "good": "鬼返信界隈", 
        "bad": "LINE未読100件界隈"
    },
    "鬼返信界隈": {
        "good": "既読スルーされた側界隈", 
        "bad": "通知OFF界隈"
    },
    "飯誘ったら秒で来る界隈": {
        "good": "深夜ラーメン即決界隈", 
        "bad": "一生片想い界隈"
    },
    "100均で爆買い界隈": {
        "good": "シンプルに金欠界隈", 
        "bad": "スタバ新作全制覇界隈"
    },
    "ポイ活ガチ勢界隈": {
        "good": "クーポン使いこなす界隈", 
        "bad": "シンプルに金欠界隈"
    },
    "クーポン使いこなす界隈": {
        "good": "ポイ活ガチ勢界隈", 
        "bad": "貯金ゼロ界隈"
    },
    "スタンプだけ送る界隈": {
        "good": "LINE未読100件界隈", 
        "bad": "鬼返信界隈"
    },
    "意味不明な略語界隈": {
        "good": "身内ノリ世界遺産界隈", 
        "bad": "だだ滑り界隈"
    },
    "身内ノリ世界遺産界隈": {
        "good": "だだ滑り界隈", 
        "bad": "意味不明な略語界隈"
    },
    "フリーWi-Fi探し界隈": {
        "good": "テザリングで生きる界隈", 
        "bad": "PC起動遅すぎ界隈"
    },
    "テザリングで生きる界隈": {
        "good": "フリーWi-Fi探し界隈", 
        "bad": "Apple信者界隈"
    },
    "ガジェットレビュー沼界隈": {
        "good": "Apple信者界隈", 
        "bad": "Android逆張り界隈"
    },
    "Apple信者界隈": {
        "good": "ガジェットレビュー沼界隈", 
        "bad": "Android逆張り界隈"
    },
    "Android逆張り界隈": {
        "good": "Apple信者界隈", 
        "bad": "ガジェットレビュー沼界隈"
    },
    "スクショフォルダ地獄界隈": {
        "good": "容量不足界隈", 
        "bad": "スマホの画面バキバキ界隈"
    },
    "容量不足界隈": {
        "good": "スクショフォルダ地獄界隈", 
        "bad": "PC起動遅すぎ界隈"
    },
    "PC起動遅すぎ界隈": {
        "good": "コンセント独占界隈", 
        "bad": "フリーWi-Fi探し界隈"
    },
    "コンセント独占界隈": {
        "good": "PC起動遅すぎ界隈", 
        "bad": "テザリングで生きる界隈"
    },
    "イヤホン無限に絡まる界隈": {
        "good": "イヤホンの片方行方不明界隈", 
        "bad": "音ゲー指バキバキ界隈"
    },
    "深夜テンションでポエム界隈": {
        "good": "だだ滑り界隈", 
        "bad": "爆モテ界隈"
    },
    "謎のモチベ爆発界隈": {
        "good": "明日から本気出す界隈", 
        "bad": "彼女いない歴＝年齢界隈"
    },
    "1週間で消える趣味界隈": {
        "good": "謎のモチベ爆発界隈", 
        "bad": "徹夜作業界隈"
    },
    "本棚だけ充実界隈": {
        "good": "積読ガチ勢界隈", 
        "bad": "黒歴史ノート発掘界隈"
    },
    "積読ガチ勢界隈": {
        "good": "本棚だけ充実界隈", 
        "bad": "寝落ち界隈"
    },
    "おしゃれ勉強風カフェ界隈": {
        "good": "カフェ巡り界隈", 
        "bad": "0から始めるノート術界隈"
    },
    "授業中に落書き界隈": {
        "good": "黒歴史ノート発掘界隈", 
        "bad": "最初のページだけ綺麗界隈"
    },
    "最初のページだけ綺麗界隈": {
        "good": "0から始めるノート術界隈", 
        "bad": "授業中夢の世界界隈"
    },
    "0から始めるノート術界隈": {
        "good": "最初のページだけ綺麗界隈", 
        "bad": "おしゃれ勉強風カフェ界隈"
    },
    "自己啓発本読みまくる界隈": {
        "good": "とりあえず朝活界隈", 
        "bad": "テスト前日爆死界隈"
    },
    "とりあえず朝活界隈": {
        "good": "自己啓発本読みまくる界隈", 
        "bad": "寝落ち界隈"
    },
    "謎の資格取りたがる界隈": {
        "good": "TOEIC勉強だけする界隈", 
        "bad": "試験前日謎の掃除界隈"
    },
    "TOEIC勉強だけする界隈": {
        "good": "謎の資格取りたがる界隈", 
        "bad": "授業中夢の世界界隈"
    },
    "試験前日謎の掃除界隈": {
        "good": "徹夜作業界隈", 
        "bad": "謎の資格取りたがる界隈"
    },
    "シャワーだけで生きる界隈": {
        "good": "風呂キャンセル界隈", 
        "bad": "風呂後にやる気消滅界隈"
    },
    "風呂後にやる気消滅界隈": {
        "good": "シャワーだけで生きる界隈", 
        "bad": "寝落ち界隈"
    },
    "カフェイン中毒界隈": {
        "good": "エナドリ依存界隈", 
        "bad": "サウナでととのう界隈"
    },
    "サウナでととのう界隈": {
        "good": "カフェイン中毒界隈", 
        "bad": "深夜テンションでポエム界隈"
    },
    "極度の方向音痴界隈": {
        "good": "グーグルマップ信者界隈", 
        "bad": "知らない街で迷子界隈"
    },
    "グーグルマップ信者界隈": {
        "good": "極度の方向音痴界隈", 
        "bad": "スマホの画面バキバキ界隈"
    },
    "知らない街で迷子界隈": {
        "good": "極度の方向音痴界隈", 
        "bad": "旅行先で財布なくす界隈"
    },
    "財布忘れて現金派終了界隈": {
        "good": "交通費ギリギリ界隈", 
        "bad": "ATM駆け込み界隈"
    },
    "交通費ギリギリ界隈": {
        "good": "貯金ゼロ界隈", 
        "bad": "財布忘れて現金派終了界隈"
    },
    "ATM駆け込み界隈": {
        "good": "貯金ゼロ界隈", 
        "bad": "シンプルに金欠界隈"
    }
}

# 実際に診断に使う界隈リスト（上記のキーと合致する100項目）
results = list(compatibility.keys())

@app.route("/", methods=["GET", "POST"])
def index():
    if request.method == "POST":
        birthdate = request.form.get("birthdate")
        color = request.form.get("color")

        if not birthdate or not color:
            return render_template("index.html", 
                                   result="生年月日と好きな色を入力してください！",
                                   good_match=f"{good_match}", 
                                   bad_match=f"{bad_match}")

        # 診断結果を決定（生年月日 + 好きな色 を種にハッシュ→結果を1つ選択）
        seed_value = birthdate + color
        hash_value = int(hashlib.md5(seed_value.encode()).hexdigest(), 16)
        result = results[hash_value % len(results)]

        # 相性データを取得（ここでは必ず存在するので KeyError は起きないはず）
        good_match = compatibility[result]["good"]
        bad_match = compatibility[result]["bad"]

        return render_template("index.html", 
                               result=f"あなたの界隈は「{result}」です！", 
                               good_match=f"相性が良い界隈: {good_match}",
                               bad_match=f"相性が悪い界隈: {bad_match}")
    
    # フォーム未入力（GETリクエスト）のとき
    return render_template("index.html", 
                           result="", 
                           good_match="", 
                           bad_match="")

if __name__ == "__main__":
    app.run(debug=True)
